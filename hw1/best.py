#!/usr/bin/env python3
from pandas import read_csv
import sys
import numpy as np

try:
    df = read_csv(sys.argv[1], encoding='big5', header=None)
except UnicodeDecodeError:
    df = read_csv(sys.argv[1], encoding='utf8', header=None)

print(df)
raw = df.values.tolist()
x_data = []

for i in range(0, len(raw), 18):
    for j in range(9):
        for k in range(18):
            if j == 0 and k == 0:
                x_data.append([raw[i+k][j+2]])
            else:
                x_data[i//18].extend([raw[i+k][j+2]])
x_data= [[float(j.replace('NR', '-1')) for j in i] for i in x_data]
x_data = np.array(x_data)

b = -119
w = [0.045714890964315961, 0.24287710117584396, -0.0012268760417467543, -0.092004977374075245, 0.12698245411777279, 0.0073069045566030756, 0.029196572246521765, 0.087907974936727362, 0.016019856063538541, 0.035691406218225197, -0.26293358499712033, 0.11439891900884758, 0.020256673661780415, 0.21611399460251574, -0.0069021271599100063, -0.0017436491018636832, 0.22885812612357437, 0.13185588836304002, 0.046542385621087291, 0.24291584919035308, -0.0088762198687393906, -0.088396491078635286, 0.11990529322267884, 0.00091793245534503196, 0.023294702718971747, 0.06170848513319329, 0.0052146528234641165, 0.019506719610677202, -0.24715997580861507, 0.11000711825614728, 0.023298637404824424, 0.21555687069400101, -0.0016016143346427438, -0.00025726848678722457, 0.22016064591681148, 0.11710520117975999, 0.048423889981193478, 0.24328771839144334, -0.0080603328808090801, -0.080597068447381751, 0.12118602306686645, -0.0011351363721252648, 0.021889608488624177, 0.044996865500315952, -0.0041455111508801124, 0.0087219180002976234, -0.24499893092436856, 0.10593346646438991, -0.0016447266841138194, 0.21656411105170348, -0.003804159302171295, 0.00048414465585447711, 0.21396636013370629, 0.10255441531324187, 0.049701627611945763, 0.24353011276894193, -0.019268102697331511, -0.071090340027263985, 0.10294415057564446, -0.0035851426923528564, 0.016688309823451326, 0.03681411808787987, -0.0052632378467525548, 0.0051180268103332696, -0.1951805671068946, 0.10332094636719961, -0.010587245056923886, 0.21759401725575109, -0.00051212217396818518, -0.00090830073943245625, 0.20893838270985057, 0.10126479824702568, 0.052554512813439869, 0.24450670862078916, -0.012441940404030891, -0.062654252053176818, 0.10191953780081885, -0.0041458650324872875, 0.01516314981779871, 0.037607440436352793, -0.0085233602322255173, 0.0024361107750728531, -0.17450071263542308, 0.10145089363985661, -0.010220420200001383, 0.22019342964847655, -0.0030391374255583099, 0.0017115410590222422, 0.20453380814482783, 0.10100559669728987, 0.054834214832757043, 0.24553543524529223, -0.0081682029393373955, -0.05394693523621593, 0.1065270004612488, -0.00030719388016860595, 0.018631344685655471, 0.046376198026530577, -0.0053932446485456965, 0.0091469061533391641, -0.12378855421662545, 0.10050153125759838, -0.002304207015659645, 0.22177753222583935, -0.0020405449975494476, -0.00088636870009803077, 0.19903782117128505, 0.097756573980359543, 0.057833695934845539, 0.24697905004160967, 0.037336532283892762, -0.021673982533636137, 0.13095165159365638, 0.021166184651377287, 0.040533016163643652, 0.067796285612523807, -0.0029610076736999481, -0.0052257494784217571, -0.1621866162723101, 0.099355480826117296, 0.018365913325248166, 0.2252551769656797, -0.0050298004955793901, -0.0023730297821258472, 0.19448198774314585, 0.087210192178363719, 0.060791623480935593, 0.25049217951616709, 0.12555509389959466, 0.042665340208501233, 0.16061765488262525, 0.074243075715441004, 0.089736632731379454, 0.10343756535920801, 0.035397537719271441, 0.16620678537985717, -0.19008480622669721, 0.10117420823425041, 0.075520032974707788, 0.23347712889792496, -0.0010273070616735912, -0.0024041518044504114, 0.1945667989716342, 0.087324992595706571, 0.064997507658930836, 0.25556075147532842, 0.20762194462355787, 0.11483046073218581, 0.19674037084074261, 0.14094282287113721, 0.14989696358954974, 0.14872983114425542, 0.11708142585768487, 0.39172534556498967, -0.21841590679616765, 0.10312550823945435, 0.13648948867661859, 0.24423306661640432, -0.00090264559549624031, 0.0024496660384668036, 0.20185154747832917, 0.10380424252166214]
w = np.array(w)
y = [np.dot(w, x) + b for x in x_data]

print(y)
f = open(sys.argv[2], 'w')
print("id,value", file=f)
for i in range(len(y)):
    print("%s,%d" % (raw[i*18][0], y[i]), file=f)
